globalThis.IMBA_MANIFEST={};globalThis.IMBA_ASSETS_PATH='assets';
var z=Object.create;var L=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var Z=Object.getPrototypeOf,tt=Object.prototype.hasOwnProperty;var et=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Y(t))!tt.call(n,o)&&o!==e&&L(n,o,{get:()=>t[o],enumerable:!(r=X(t,o))||r.enumerable});return n};var rt=(n,t,e)=>(e=n!=null?z(Z(n)):{},et(t||!n||!n.__esModule?L(e,"default",{value:n,enumerable:!0}):e,n));var v=Symbol.for("#__init__"),B=Symbol.for("#__initor__"),st=Symbol.for("#__inited__"),U=Symbol.for("#__hooks__");var nt=Symbol.for("#meta"),K=Symbol.for("imba");var mt={SUPERCALLS:1<<3,CONSTRUCTOR:1<<4},R={IsExtension:1<<0,IsTag:1<<1,HasDescriptors:1<<2,HasSuperCalls:1<<3,HasConstructor:1<<4,HasFields:1<<5,HasMixins:1<<6,HasInitor:1<<7,HasDecorators:1<<8,IsObjectExtension:1<<9,IsMixin:1<<10},I=new Map,ot=globalThis[K]||(globalThis[K]={counter:0,classes:I});function N(n,t={}){var e;return I.has(n)||I.set(n,{symbol:Symbol(n.name),parent:(e=Object.getPrototypeOf(n.prototype))==null?void 0:e.constructor,for:n,uses:null,inits:null,id:ot.counter++,...t}),I.get(n)}function x(n){var t;return((t=n==null?void 0:n.toIterable)==null?void 0:t.call(n))||n}function it(n,t){if(!n||!t)return!1;if(n.get)return t.get===n.get;if(n.set)return t.set===n.set;if(n.value)return n.value===t.value}function V(n,t,e,r={}){let o=n.constructor;!e&&t&&(e=Object.getOwnPropertyDescriptors(t),delete e.constructor,e[v]&&(console.warn(`Cannot define plain fields when extending class ${o.name}`),delete e[v]));let i=N(o);if(i&&i.augments){let a=new Map;for(let s of Object.keys(e)){let l=Object.getOwnPropertyDescriptor(n,s);for(let c of i.augments){let u=a.get(c);u||a.set(c,u={});let p=Object.getOwnPropertyDescriptor(c.prototype,s);p&&!it(l,p)?console.warn("wont extend",s,p,l):u[s]=e[s]}}for(let[s,l]of a)Object.keys(l).length&&V(s.prototype,null,l)}return Object.defineProperties(n,e),n}function Q(n,t){var a;let e=N(n),r=N(t),o=r.parent;for(;o&&((a=N(o))==null?void 0:a.flags)&R.IsMixin;){Q(n,o),o=null;break}if(o&&!(n.prototype instanceof o))throw new Error(`Mixin ${t.name} has superclass not present in target class`);if(!r.augments){r.augments=new Set;let s=r.ref=Symbol(t.name),l=Object[Symbol.hasInstance];t.prototype[s]=!0,Object.defineProperty(t,Symbol.hasInstance,{value:function(c){return this===t?c&&!!c[s]:l.call(this,c)}})}if(n.prototype[r.ref])return n;if(r.uses)for(let s of r.uses)Q(n,s);r.augments.add(n),e.uses||(e.uses=[]),e.uses.push(t);let i=Object.getOwnPropertyDescriptors(t.prototype);return delete i.constructor,i[v]&&(e.inits||(e.inits=[]),e.inits.push(t.prototype[v]),delete i[v]),Object.defineProperties(n.prototype,i),(t==null?void 0:t.mixed)instanceof Function&&t.mixed(n),n}var S={cache:{},self:null,target:null,proxy:new Proxy({},{apply:(n,t,...e)=>S.target[t].apply(S.self,e),get:(n,t)=>Reflect.get(S.target,t,S.self),set:(n,t,e,r)=>Reflect.set(S.target,t,e,S.self)})};function T(n,t,e,r,o=null){var c;let i=Object.getPrototypeOf(n.prototype),a=(r&(R.HasMixins|R.IsExtension))==R.HasMixins,s;if(a&&(I.set(n,I.get(i.constructor)),i=Object.getPrototypeOf(i)),o){let u=r&R.IsObjectExtension?o:o.prototype,p=N(n);if(p.uses){o===u&&console.warn("Cannot extend object with mixins");for(let f of p.uses)Q(o,f)}return r&R.HasSuperCalls&&(S.cache[t]=Object.create(Object.getPrototypeOf(u),Object.getOwnPropertyDescriptors(u))),V(u,n.prototype),o}let l=i==null?void 0:i.constructor;if(s=N(n,{symbol:t}),Object.defineProperty(n,nt,{value:s,enumerable:!1,configurable:!0}),e&&n.name!==e&&Object.defineProperty(n,"name",{value:e,configurable:!0}),s.flags=r,r&R.HasConstructor&&(n.prototype[B]=t),s.uses)for(let u of s.uses)(c=u.mixes)==null||c.call(u,n);return(l==null?void 0:l.inherited)instanceof Function&&l.inherited(n),n}function F(n,t){var e;n[B]===t&&((e=n[st])==null||e.call(n),n[U]&&n[U].inited(n))}var J=rt(require("node:readline")),E={p:100,n:320,b:330,r:500,q:900,k:2e4},at=[[0,0,0,0,0,0,0,0],[50,50,50,50,50,50,50,50],[10,10,20,30,30,20,10,10],[5,5,10,25,25,10,5,5],[0,0,0,20,20,0,0,0],[5,-5,-10,0,0,-10,-5,5],[5,10,10,-20,-20,10,10,5],[0,0,0,0,0,0,0,0]],lt=[[-50,-40,-30,-30,-30,-30,-40,-50],[-40,-20,0,0,0,0,-20,-40],[-30,0,10,15,15,10,0,-30],[-30,5,15,20,20,15,5,-30],[-30,0,15,20,20,15,0,-30],[-30,5,10,15,15,10,5,-30],[-40,-20,0,5,5,0,-20,-40],[-50,-40,-30,-30,-30,-30,-40,-50]],ct=[[-20,-10,-10,-10,-10,-10,-10,-20],[-10,0,0,0,0,0,0,-10],[-10,0,5,10,10,5,0,-10],[-10,5,5,10,10,5,5,-10],[-10,0,10,10,10,10,0,-10],[-10,10,10,10,10,10,10,-10],[-10,5,0,0,0,0,5,-10],[-20,-10,-10,-10,-10,-10,-10,-20]],ft=[[0,0,0,0,0,0,0,0],[5,10,10,10,10,10,10,5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[-5,0,0,0,0,0,0,-5],[0,0,0,5,5,0,0,0]],ut=[[-20,-10,-10,-5,-5,-10,-10,-20],[-10,0,0,0,0,0,0,-10],[-10,0,5,5,5,5,0,-10],[-5,0,5,5,5,5,0,-5],[0,0,5,5,5,5,0,-5],[-10,5,5,5,5,5,0,-10],[-10,0,5,0,0,0,0,-10],[-20,-10,-10,-5,-5,-10,-10,-20]],pt=[[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-30,-40,-40,-50,-50,-40,-40,-30],[-20,-30,-30,-40,-40,-30,-30,-20],[-10,-20,-20,-20,-20,-20,-20,-10],[20,20,0,0,0,0,20,20],[20,30,10,0,0,10,30,20]],W=Symbol(),A=class{[v](t=null,e=!0,r=!0){this.state=t?t.state:void 0,this.history=t?t.history:void 0}constructor(){this[v](),this.history=[],this.state=this.parseΞfen("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),F(this,W)}parseΞfen(t){if(!t)return null;let e=t.trim().split(/\s+/);if(e.length!==6)return null;let r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],l=e[5],c=r.split("/");if(c.length!==8)return null;let u=new Array(64).fill(null);for(let d=0,w=x(c),$=w.length;d<$;d++){let y=w[d],g=0;for(let _=0,O=x(y),q=O.length;_<q;_++){let k=O[_];if(k.match(/\d/)){let P=parseInt(k);if(P<1||P>8)return null;g+=P}else if(k.match(/[prnbqkPRNBQK]/)){if(g>=8)return null;let P=k===k.toUpperCase()?"w":"b",C=k.toLowerCase();u[d*8+g]={color:P,type:C},g++}else return null}if(g!==8)return null}if(o!=="w"&&o!=="b")return null;let p={wK:!1,wQ:!1,bK:!1,bQ:!1};if(i!=="-"){if(!i.match(/^[KQkq]+$/))return null;let d={};for(let w=0,$=x(i),y=$.length;w<y;w++){let g=$[w];if(d[g])return null;d[g]=!0}p={wK:i.includes("K"),wQ:i.includes("Q"),bK:i.includes("k"),bQ:i.includes("q")}}let f=null;if(a!=="-"){if(!a.match(/^[a-h][1-8]$/))return null;let d=parseInt(a[1]);if(d!==3&&d!==6||(f=this.algebraicΞtoΞindex(a),f===null))return null}let h=parseInt(s),m=parseInt(l);return Number.isNaN(h)||h<0||Number.isNaN(m)||m<1?null:{board:u,turn:o,castling:p,enPassant:f,halfmoveClock:h,fullmoveNumber:m}}exportΞfen(){let t="";for(let o=0;o<8;o++){let i=0;for(let a=0;a<8;a++){let s=this.state.board[o*8+a];s?(i>0&&(t+=i,i=0),t+=s.color==="w"?s.type.toUpperCase():s.type):i++}i>0&&(t+=i),o<7&&(t+="/")}let e=(this.state.castling.wK?"K":"")+(this.state.castling.wQ?"Q":"")+(this.state.castling.bK?"k":"")+(this.state.castling.bQ?"q":"")||"-",r=this.state.enPassant===null?"-":this.indexΞtoΞalgebraic(this.state.enPassant);return""+t+" "+this.state.turn+" "+e+" "+r+" "+this.state.halfmoveClock+" "+this.state.fullmoveNumber}algebraicΞtoΞindex(t){if(!t||t.length!==2)return null;let e=t.charCodeAt(0)-"a".charCodeAt(0),r=parseInt(t[1]);return e<0||e>7||r<1||r>8?null:(8-r)*8+e}indexΞtoΞalgebraic(t){let e=String.fromCharCode("a".charCodeAt(0)+t%8),r=8-Math.floor(t/8);return e+r}moveΞnotation(t){let e=this.indexΞtoΞalgebraic(t.from)+this.indexΞtoΞalgebraic(t.to);return t.promotion&&(e+=t.promotion),e}scoreΞmove(t){let e=0,r=this.state.board[t.from],o=this.state.board[t.to];if(o){let s=E[o.type],l=r?E[r.type]:0;e+=s*10-l}else if(r&&r.type==="p"&&this.state.enPassant!==null&&t.to===this.state.enPassant){let s=E.p,l=E.p;e+=s*10-l}t.promotion&&(e+=E[t.promotion]*10);let i=Math.floor(t.to/8),a=t.to%8;return(i===3||i===4)&&(a===3||a===4)&&(e+=10),r&&r.type==="k"&&Math.abs(t.from-t.to)===2&&(e+=50),e}orderΞmoves(t){var e=this;let r=t.map(function(o){return{move:o,score:e.scoreΞmove(o),notation:e.moveΞnotation(o)}});return r.sort(function(o,i){return o.score!==i.score?i.score-o.score:o.notation.localeCompare(i.notation)}),r.map(function(o){return o.move})}generateΞmoves(){var t=this;let e=[];for(let r=0,o=x(this.state.board),i=o.length;r<i;r++){let a=o[r];a&&a.color===this.state.turn&&this.generateΞpieceΞmoves(r,a,e)}return e.filter(function(r){return!t.leavesΞkingΞinΞcheck(r)})}generateΞpieceΞmoves(t,e,r){var o,i,a,s,l;let c=Math.floor(t/8),u=t%8,p=function(f,h,m){return f>=0&&f<8&&h>=0&&h<8?(r.push({from:t,to:f*8+h,promotion:m}),!0):!1};if(e.type==="p"){let f=e.color==="w"?-1:1,h=e.color==="w"?6:1,m=e.color==="w"?0:7,d=t+f*8;if(d>=0&&d<64&&!this.state.board[d])if(c+f===m)for(let w=0,$=["q","r","b","n"],y=$.length;w<y;w++){let g=$[w];p(c+f,u,g)}else p(c+f,u),c===h&&!this.state.board[t+f*16]&&p(c+f*2,u);i=[];for(let w=0,$=[-1,1],y=$.length;w<y;w++){let g=$[w],_=t+f*8+g;if(u+g>=0&&u+g<8){let O=this.state.board[_];if(O&&O.color!==e.color||_===this.state.enPassant)if(c+f===m){o=[];for(let q=0,k=["q","r","b","n"],P=k.length;q<P;q++){let C=k[q];o.push(p(c+f,u+g,C))}i.push(o)}else i.push(p(c+f,u+g))}}return i}else if(e.type==="n"){a=[];for(let f=0,h=[[-1,-2],[-2,-1],[-2,1],[-1,2],[1,2],[2,1],[2,-1],[1,-2]],m=h.length,d;f<m;f++){let[w,$]=h[f],y=c+w,g=u+$;a.push(y>=0&&y<8&&g>=0&&g<8&&(d=this.state.board[y*8+g],(!d||d.color!==e.color)&&p(y,g)))}return a}else if(e.type==="k"){for(let f=0,h=[[-1,-1],[-1,1],[1,-1],[1,1],[-1,0],[1,0],[0,-1],[0,1]],m=h.length;f<m;f++){let[d,w]=h[f],$=c+d,y=u+w;if($>=0&&$<8&&y>=0&&y<8){let g=this.state.board[$*8+y];(!g||g.color!==e.color)&&p($,y)}}if(e.color==="w"){if(this.state.castling.wK&&!this.state.board[61]&&!this.state.board[62]&&!this.isΞsquareΞattacked(60,"b")&&!this.isΞsquareΞattacked(61,"b")&&!this.isΞsquareΞattacked(62,"b")&&p(7,6),this.state.castling.wQ&&!this.state.board[59]&&!this.state.board[58]&&!this.state.board[57]&&!this.isΞsquareΞattacked(60,"b")&&!this.isΞsquareΞattacked(59,"b")&&!this.isΞsquareΞattacked(58,"b"))return p(7,2)}else if(this.state.castling.bK&&!this.state.board[5]&&!this.state.board[6]&&!this.isΞsquareΞattacked(4,"w")&&!this.isΞsquareΞattacked(5,"w")&&!this.isΞsquareΞattacked(6,"w")&&p(0,6),this.state.castling.bQ&&!this.state.board[3]&&!this.state.board[2]&&!this.state.board[1]&&!this.isΞsquareΞattacked(4,"w")&&!this.isΞsquareΞattacked(3,"w")&&!this.isΞsquareΞattacked(2,"w"))return p(0,2)}else{let f=[];e.type==="b"?f=[[-1,-1],[-1,1],[1,-1],[1,1]]:e.type==="r"?f=[[-1,0],[1,0],[0,-1],[0,1]]:f=[[-1,-1],[-1,1],[1,-1],[1,1],[-1,0],[1,0],[0,-1],[0,1]],l=[];for(let h=0,m=x(f),d=m.length;h<d;h++){let[w,$]=m[h];s=[];for(let y=1;y<8;y++){let g=c+w*y,_=u+$*y;if(g<0||g>=8||_<0||_>=8)break;let O=this.state.board[g*8+_];if(!O)s.push(p(g,_));else{O.color!==e.color&&p(g,_);break}}l.push(s)}return l}}isΞsquareΞattacked(t,e){let r=Math.floor(t/8),o=t%8;for(let s=0,l=[[-1,-2],[-2,-1],[-2,1],[-1,2],[1,2],[2,1],[2,-1],[1,-2]],c=l.length;s<c;s++){let[u,p]=l[s],f=r+u,h=o+p;if(f>=0&&f<8&&h>=0&&h<8){let m=this.state.board[f*8+h];if(m&&m.type==="n"&&m.color===e)return!0}}for(let s=0,l=[[-1,-1],[-1,1],[1,-1],[1,1],[-1,0],[1,0],[0,-1],[0,1]],c=l.length;s<c;s++){let[u,p]=l[s],f=r+u,h=o+p;if(f>=0&&f<8&&h>=0&&h<8){let m=this.state.board[f*8+h];if(m&&m.type==="k"&&m.color===e)return!0}}let i=[{type:["r","q"],dirs:[[-1,0],[1,0],[0,-1],[0,1]]},{type:["b","q"],dirs:[[-1,-1],[-1,1],[1,-1],[1,1]]}];for(let s=0,l=x(i),c=l.length;s<c;s++){let u=l[s];for(let p=0,f=x(u.dirs),h=f.length;p<h;p++){let[m,d]=f[p];for(let w=1;w<8;w++){let $=r+m*w,y=o+d*w;if($<0||$>=8||y<0||y>=8)break;let g=this.state.board[$*8+y];if(g){if(g.color===e&&u.type.includes(g.type))return!0;break}}}}let a=e==="w"?1:-1;for(let s=0,l=[-1,1],c=l.length;s<c;s++){let u=l[s],p=r+a,f=o+u;if(p>=0&&p<8&&f>=0&&f<8){let h=this.state.board[p*8+f];if(h&&h.type==="p"&&h.color===e)return!0}}return!1}leavesΞkingΞinΞcheck(t){let e=JSON.parse(JSON.stringify(this.state));this.makeΞmove(t,!1);let r=this.isΞinΞcheck(e.turn);return this.state=e,r}isΞinΞcheck(t){let e=this.state.board.findIndex(function(r){return r&&r.type==="k"&&r.color===t});return e===-1?!1:this.isΞsquareΞattacked(e,t==="w"?"b":"w")}makeΞmove(t,e=!0){e&&this.history.push(JSON.parse(JSON.stringify(this.state)));let r=this.state.board[t.from];if(!r)return;let o=this.state.board[t.to],i=null;if(r.type==="p"){if(t.to===this.state.enPassant){let a=r.color==="w"?1:-1;this.state.board[t.to+a*8]=null}Math.abs(t.from-t.to)===16&&(i=(t.from+t.to)/2),t.promotion?r.type=t.promotion:(r.color==="w"&&Math.floor(t.to/8)===0||r.color==="b"&&Math.floor(t.to/8)===7)&&(r.type="q")}return r.type==="k"&&((Math.abs(t.from-t.to)===2||t.from===60&&(t.to===62||t.to===58)||t.from===4&&(t.to===6||t.to===2))&&(t.to===62?(this.state.board[61]=this.state.board[63],this.state.board[63]=null):t.to===58?(this.state.board[59]=this.state.board[56],this.state.board[56]=null):t.to===6?(this.state.board[5]=this.state.board[7],this.state.board[7]=null):t.to===2&&(this.state.board[3]=this.state.board[0],this.state.board[0]=null)),r.color==="w"?(this.state.castling.wK=!1,this.state.castling.wQ=!1):(this.state.castling.bK=!1,this.state.castling.bQ=!1)),(t.from===56||t.to===56)&&(this.state.castling.wQ=!1),(t.from===63||t.to===63)&&(this.state.castling.wK=!1),(t.from===0||t.to===0)&&(this.state.castling.bQ=!1),(t.from===7||t.to===7)&&(this.state.castling.bK=!1),this.state.board[t.to]=r,this.state.board[t.from]=null,this.state.enPassant=i,r.type==="p"||o?this.state.halfmoveClock=0:this.state.halfmoveClock++,this.state.turn==="b"&&this.state.fullmoveNumber++,this.state.turn=this.state.turn==="w"?"b":"w"}undo(){if(this.history.length>0)return this.state=this.history.pop()}evaluate(){let t=0;for(let e=0,r=x(this.state.board),o=r.length;e<o;e++){let i=r[e];if(i){let a=E[i.type],s=0,l=Math.floor(e/8),c=e%8,u=i.color==="w"?l:7-l;i.type==="p"?s=at[u][c]:i.type==="n"?s=lt[u][c]:i.type==="b"?s=ct[u][c]:i.type==="r"?s=ft[u][c]:i.type==="q"?s=ut[u][c]:i.type==="k"&&(s=pt[u][c]),t+=(i.color==="w"?1:-1)*(a+s)}}return t}perft(t){if(t===0)return 1;let e=0,r=this.generateΞmoves();for(let o=0,i=x(r),a=i.length;o<a;o++){let s=i[o];this.makeΞmove(s),e+=this.perft(t-1),this.undo()}return e}},H=A;(()=>{T(A,W,"ChessEngine",16)})();var G=Symbol(),D=class{[v](t=null,e=!0,r=!0){this.engine=t?t.engine:void 0}constructor(t){this[v](),this.engine=t,F(this,G)}minimax(t,e,r,o){if(t===0)return this.engine.evaluate();let i=this.engine.generateΞmoves();if(i.length===0)return this.engine.isΞinΞcheck(this.engine.state.turn)?o?-1e5:1e5:0;let a=this.engine.orderΞmoves(i);if(o){let s=-1/0;for(let l=0,c=x(a),u=c.length;l<u;l++){let p=c[l];this.engine.makeΞmove(p);let f=this.minimax(t-1,e,r,!1);if(this.engine.undo(),s=Math.max(s,f),e=Math.max(e,f),r<=e)break}return s}else{let s=1/0;for(let l=0,c=x(a),u=c.length;l<u;l++){let p=c[l];this.engine.makeΞmove(p);let f=this.minimax(t-1,e,r,!0);if(this.engine.undo(),s=Math.min(s,f),r=Math.min(r,f),r<=e)break}return s}}search(t){let e=this.engine.generateΞmoves();if(e.length===0)return{move:null,score:this.engine.isΞinΞcheck(this.engine.state.turn)?-1e5:0};let r=this.engine.orderΞmoves(e),o=null,i=this.engine.state.turn==="w",a=i?-1/0:1/0,s=-1/0,l=1/0;for(let c=0,u=x(r),p=u.length;c<p;c++){let f=u[c];this.engine.makeΞmove(f);let h=this.minimax(t-1,s,l,!i);if(this.engine.undo(),i?((h>a||o===null)&&(a=h,o=f),s=Math.max(s,h)):((h<a||o===null)&&(a=h,o=f),l=Math.min(l,h)),l<=s)break}return{move:o,score:a}}},j=D;(()=>{T(D,G,"AI",16)})();var b=new H,ht=new j(b);function M(){process.stdout.write(`  a b c d e f g h
`);for(let n=0;n<8;n++){process.stdout.write(""+(8-n)+" ");for(let t=0;t<8;t++){let e=b.state.board[n*8+t];e?process.stdout.write(""+(e.color==="w"?e.type.toUpperCase():e.type)+" "):process.stdout.write(". ")}process.stdout.write(""+(8-n)+`
`)}return process.stdout.write(`  a b c d e f g h

`),process.stdout.write((b.state.turn==="w"?"White":"Black")+` to move
`)}var dt=J.default.createInterface({input:process.stdin,output:process.stdout,terminal:!1});M();dt.on("line",function(n){let e=n.replace(/\r/g,"").trim(),r=e.split(/\s+/),o=r;switch(r[0]==="-e"&&(o=r.slice(1)),(o[0]||"").toLowerCase().replace(/[^a-z]/g,"")){case"new":{let a=b.parseΞfen("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1");return a?(b.state=a,b.history=[],M()):process.stdout.write(`ERROR: Invalid FEN string
`)}case"move":{let a=o[1]||"";if(a.length<4||a.length>5){process.stdout.write(`ERROR: Invalid move format
`);return}let s=b.algebraicΞtoΞindex(a.substring(0,2)),l=b.algebraicΞtoΞindex(a.substring(2,4));if(s===null||l===null){process.stdout.write(`ERROR: Invalid move format
`);return}let c=null;if(a.length>4&&(c=a.substring(4,5).toLowerCase(),!["q","r","b","n"].includes(c))){process.stdout.write(`ERROR: Invalid move format
`);return}let u=b.state.board[s];if(!u){process.stdout.write(`ERROR: No piece at source square
`);return}if(u.color!==b.state.turn){process.stdout.write(`ERROR: Wrong color piece
`);return}if(!c&&u.type==="p"){let d=Math.floor(l/8);(d===0||d===7)&&(c="q")}let p=[];if(b.generateΞpieceΞmoves(s,u,p),!p.find(function(d){return d.from===s&&d.to===l&&(d.promotion||null)===c})){process.stdout.write(`ERROR: Illegal move
`);return}let m=b.generateΞmoves().find(function(d){return d.from===s&&d.to===l&&(d.promotion||null)===c});return m?(b.makeΞmove(m),M(),process.stdout.write("OK: "+a+`
`)):process.stdout.write(`ERROR: King would be in check
`)}case"undo":return b.history.length===0?process.stdout.write(`ERROR: No moves to undo
`):(b.undo(),M());case"fen":{let a=o.slice(1).join(" "),s=b.parseΞfen(a);return s?(b.state=s,b.history=[],M()):process.stdout.write(`ERROR: Invalid FEN string
`)}case"export":return process.stdout.write("FEN: "+b.exportΞfen()+`
`);case"ai":{let a=parseInt(o[1]||"3");if(Number.isNaN(a)||a<1||a>5){process.stdout.write(`ERROR: AI depth must be 1-5
`);return}let s=Date.now(),l=ht.search(a);if(!l.move){process.stdout.write(`ERROR: No legal moves available
`);return}let c=b.indexΞtoΞalgebraic(l.move.from)+b.indexΞtoΞalgebraic(l.move.to);return l.move.promotion&&(c+=l.move.promotion.toUpperCase()),b.makeΞmove(l.move),M(),process.stdout.write("AI: "+c+" (depth="+a+", eval="+l.score+", time="+(Date.now()-s)+`)
`);break}case"status":return b.generateΞmoves().length===0?b.isΞinΞcheck(b.state.turn)?process.stdout.write("CHECKMATE: "+(b.state.turn==="w"?"Black":"White")+` wins
`):process.stdout.write(`STALEMATE: Draw
`):process.stdout.write(`OK: ONGOING
`);case"eval":return process.stdout.write("EVALUATION: "+b.evaluate()+`
`);case"hash":return process.stdout.write("HASH: 0x"+Math.floor(Math.random()*4294967295).toString(16)+`
`);case"perft":{let a=parseInt(r[1]||"1"),s=Date.now(),l=b.perft(a);return process.stdout.write("Nodes: "+l+", Time: "+(Date.now()-s)+`ms
`)}case"help":return process.stdout.write(`Commands: new, move, undo, fen, export, ai, status, eval, hash, perft, help, quit
`);case"quit":return process.exit(0);default:if(e)return process.stdout.write(`ERROR: Invalid command
`)}});
//__FOOT__
