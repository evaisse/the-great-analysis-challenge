name: Quick Build Check

on:
  push:
    paths:
      - 'implementations/*/Dockerfile'
      - 'implementations/*/src/**'
      - 'implementations/*/lib/**'
      - 'implementations/*/bin/**'
      - 'implementations/**/*.cr'
      - 'implementations/**/*.rs'
      - 'implementations/**/*.go'
      - 'implementations/**/*.dart'
      - 'implementations/**/*.ts'
      - 'implementations/**/*.gleam'
      - 'implementations/**/*.kt'
      - 'implementations/**/*.kts'
  workflow_dispatch:

jobs:
  quick-build:
    name: Quick Build Test
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build all implementations
        run: |
          echo "🚀 Quick build test for all chess engines"
          echo "======================================="
          
          success_count=0
          total_count=0
          
          for lang in rust go dart typescript gleam kotlin crystal ruby julia haskell elm; do
            dir="implementations/$lang"
            if [ -d "$dir" ] && [ -f "$dir/Dockerfile" ]; then
              total_count=$((total_count + 1))
              echo ""
              echo "🏗️ Building $lang..."
              
              cd "$dir"
              if docker build -t "chess-$lang-quick" . --quiet; then
                echo "✅ $lang: Build successful"
                success_count=$((success_count + 1))
                docker rmi "chess-$lang-quick" || true
              else
                echo "❌ $lang: Build failed"
              fi
              cd ..
            fi
          done
          
          echo ""
          echo "📊 Results: $success_count/$total_count builds successful"
          
          if [ $success_count -eq $total_count ]; then
            echo "🎉 All builds passed!"
            exit 0
          else
            echo "❌ Some builds failed"
            exit 1
          fi