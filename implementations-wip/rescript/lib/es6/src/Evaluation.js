// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Types from "./Types.js";
import * as Utils from "./Utils.js";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";

function isEndgame(state) {
  var pieceCount = 0;
  var queenCount = 0;
  for(var square = 0; square <= 63; ++square){
    var piece = Belt_Array.getExn(state.board, square);
    if (piece !== undefined && piece.pieceType !== "King" && piece.pieceType !== "Pawn") {
      pieceCount = pieceCount + 1 | 0;
      if (piece.pieceType === "Queen") {
        queenCount = queenCount + 1 | 0;
      }
      
    }
    
  }
  if (pieceCount <= 4) {
    return true;
  } else if (pieceCount <= 6) {
    return queenCount === 0;
  } else {
    return false;
  }
}

function positionBonus(state, square, piece) {
  var file = Utils.modInt(square, 8);
  var rank = square / 8 | 0;
  var bonus = 0;
  var centerSquares = [
    27,
    28,
    35,
    36
  ];
  if (Belt_Array.some(centerSquares, (function (value) {
            return value === square;
          }))) {
    bonus = bonus + 10 | 0;
  }
  var match = piece.pieceType;
  switch (match) {
    case "Pawn" :
        var advancement = piece.color === "White" ? rank : 7 - rank | 0;
        bonus = bonus + Math.imul(advancement, 5) | 0;
        break;
    case "King" :
        if (!isEndgame(state)) {
          var kingSafetyRow = piece.color === "White" ? 0 : 7;
          bonus = rank === kingSafetyRow && (file <= 2 || file >= 5) ? bonus + 20 | 0 : bonus - 20 | 0;
        }
        break;
    default:
      
  }
  return bonus;
}

function evaluateGameState(state) {
  var score = 0;
  for(var square = 0; square <= 63; ++square){
    var piece = Belt_Array.getExn(state.board, square);
    if (piece !== undefined) {
      var value = Types.pieceValue(piece.pieceType);
      var bonus = positionBonus(state, square, piece);
      var total = value + bonus | 0;
      score = piece.color === "White" ? score + total | 0 : score - total | 0;
    }
    
  }
  return score;
}

export {
  isEndgame ,
  positionBonus ,
  evaluateGameState ,
}
/* No side effect */
